{% assign hoje = 'now' | date: '%Y-%m-%d' %}
{% assign data_vencedora = '2099-12-31' %}
{% assign escala_vencedora = nil %}

{% comment %} 1. Loop através de todas as escalas {% endcomment %}
{% for item in site.data.escalas %}

{% comment %} 2. Loop através das datas dentro de cada escala {% endcomment %}
  {% for dia_raw in item.dias %}

  {% assign dia_formatado = dia_raw | date: '%Y-%m-%d' %}

  {% comment %} 3. Verifica se a data é futura (ou hoje) {% endcomment %}
    {% if dia_formatado >= hoje %}

    {% comment %} 4. Verifica se essa data é menor que a "vencedora" atual {% endcomment %}
      {% if dia_formatado < data_vencedora %}
      {% assign data_vencedora = dia_formatado %}
      {% assign escala_vencedora = item %}
      {% endif %}

    {% endif %}
  {% endfor %}
{% endfor %}

{% if escala_vencedora %}
  {% assign numero_mes = data_vencedora | date: "%-m" | minus: 1 %} 
  {% assign nome_mes = site.data.meses.nomes[numero_mes] %}

  <section class="max-w-2xl mx-auto lg:mx-0">
    <div class="{{escala_vencedora.cor}} rounded-2xl p-6 text-white shadow-lg " >
      <div class="flex justify-between items-start mb-4">
        <span
          class="bg-white/20 px-3 py-1 rounded-md text-xs font-bold backdrop-blur-sm border border-white/10" >   
          {% if data_vencedora == hoje %} Hoje {% endif %}
          {% if data_vencedora <> hoje %} Próxima escala {% endif %}
        </span >
      </div>
  
      <h2 class="text-2xl font-bold my-2">
        {{escala_vencedora.dia}}, {{data_vencedora | date: "%d"}} {{nome_mes }}, Escala {{escala_vencedora.escala}} 
      </h2>
      <div class="flex gap-3">
        <a
          href="{{ escala_vencedora.id | datapage_url: '' }}"
          class="flex-1 bg-white text-indigo-700 py-3 rounded-xl font-bold text-sm hover:bg-indigo-50 transition text-center shadow-sm"
        >
          Ver Escala
        </a>
      </div>
    </div>
  </section>
{% endif %}
